<template name="games">
  <div class="games">
    {{#if team }}{{#with team }}
      {{make_team_updates}}
      <header>
        <a href="/leagues" class="back btn"><span class="arrow"></span>Leagues</a>
        <h1>Season Games</h1>
        {{> logged_in_user }}
      </header>
      
      <article>
        {{#if next_game}}
          {{> next_game }}
          {{> upcoming_games }}
        {{else}}
          <div class="no_games">
            <div class="game_builder">
              <form>
                <h3>Make game</h3>
                <div class="chrono">
                  <label for="date">Starts:</label>
                  <span id="date">Today</span>
                  <input id="date" name="date"/>
                  <hr>
                  <label for="time">Game time:</label>
                  <span id="time">Now</span>
                  <input id="date" name="time"/>
                </div>
                <button type="submit" class="btn default"  disabled="true">Make</button>
              </form>
              <a class="season_toggle inset">Want to plan a season?</a>
            </div>
            <div class="season_builder">
              <form>
                <h3>Plan season</h3>
                <div class="days">
                  <input type="checkbox" id="monday" value="monday" /><label for="monday">Mo</label>
                  <input type="checkbox" id="tuesday" value="tuesday" /><label for="tuesday">Tu</label>
                  <input type="checkbox" id="wednesday" value="wednesday" /><label for="wednesday">We</label>
                  <input type="checkbox" id="thursday" value="thursday" /><label for="thursday">Th</label>
                  <br>
                  <input type="checkbox" id="friday" value="friday" /><label for="friday">Fr</label>
                  <input type="checkbox" id="saturday" value="saturday" /><label for="saturday">Sa</label>
                  <input type="checkbox" id="sunday" value="sunday" /><label for="sunday">Su</label>
                </div>
                <div class="select">
                  <select name="">
                    <option selected value="1">1</option>
                    <option selected value="2">2</option>
                    <option selected value="3">3</option>
                    <option selected value="4">4</option>
                  </select>
                  <a class="btn secondary">
                    <span class="selected_text">14 Games</span>
                    <span class="icon12 arrows"></span>
                  </a>
                </div>
                <div class="chrono">
                  <label for="date">Starts:</label>
                  <span id="date">Today</span>
                  <input id="date" name="date"/>
                  <hr>
                  <label for="time">Game time:</label>
                  <span id="time">Now</span>
                  <input id="date" name="time"/>
                </div>
                <button type="submit" class="btn default"  disabled="true">Create</button>
              </form>
              <a class="games_toggle inset">Make a game instead?</a>
            </div>
          </div>
        {{/if}}
      </article>
      
    {{/with}}{{else}}
      {{> not_found}}
    {{/if}}
  </div>
</template>

<template name="next_game">
  <form class="next_game" name="game">
    <aside class="next">Next Game</aside>
      {{{ logo this size="large" without_link=true }}}
    <p>{{ name }}</p>
    {{#with next_game }}
      <h2 class="game_title editable" data-field="location">
        {{ location_or_game_number }}
        {{#if_editing "location"}}
          <div class="edit_location">
            <label for="location">Location:</label>
            <input name="location" value="{{attributes.location}}" placeholder="Where is the game?"/>
          </div>
        {{/if_editing}}
      </h2>
      
      <div class="game_date editable" data-field="date">
        <strong>{{ qualified_day }}</strong>
        &nbsp;&nbsp;{{ time }}&nbsp;&nbsp;
        {{ formatted_date }}
        {{#if_editing "date"}}
          {{> date_chooser}}
        {{/if_editing}}
      </div>
      
      <ul class="player_list state_aware">
        {{#each player_availabilities}}
          {{> player_availability }}
        {{/each}}
      </ul>
      <a class="edit icon16 inset">Edit this game</a>
    {{/with}}
  </form>
</template>

<template name="upcoming_games">
  <div class="divider"></div>
  <div class="upcoming_games">
    <a class="view_more"><small>Rest of your games &darr;</small></a>
    <div class="season">
      <h2>Your Season</h2>
      <ul class="games">
        {{#each upcoming_games }}
          {{> game }}
        {{/each}}
        <a class="create_game btn default">Add games</a>
      </ul>
    </div>
  </div>
</template>

<template name="game">
  <li>
    <form name="game">
      <div class="date editable" data-field="date">
        <span class="month">{{month}}</span>
        <span class="day">{{date}}</span>
        <span class="time">{{time}}</span>
        {{#if_editing "date"}}
          {{> date_chooser}}
        {{/if_editing}}
      </div>
      
      <div class="meta">
        <div class="confirmation {{availability_class current_user_availability}}">
          <form>
            <div class="state_question">
              <input type="radio" id="play" value="play">
              <label for="play" class="play">Play</label>
              <br>
              <input type="radio" id="state" value="bench">
              <label for="bench" class="bench">Bench</label>
              <br>
              <em class="state">You're unconfirmed</em>
            </div>
          </form>
          <div class="state_playing">
            <figure></figure>
            <br>
            <a class="inset go_unconfirmed">Change &raquo;</a>
          </div>
          <div class="state_benched">
            <figure>Bench</figure>
            <br>
            <a class="inset go_unconfirmed">Play this game &raquo;</a>
          </div>
        </div>
        
        <h3 class="location editable" data-field="location">
          {{#if_editing "location"}}
            <div class="location">
              <label for="location">Location:</label>
              <input name="location" value="{{attributes.location}}" placeholder="Where is the game?"/>
            </div>
          {{else}}
            {{#if attributes.location}}
              {{attributes.location}}
            {{else}}
              <em>Location TBD</em>
            {{/if}}
          {{/if_editing}}
        </h3>
        
        {{#if_equals 0 team_state}}
          <p class="flag green">Your team is rarin' to play! Have fun out there.</p>
        {{else}}
          {{#if_equals 1 team_state}}
            <p class="flag yellow">Waiting on {{pluralize "player" confirmations_needed}} to confirm</p>
          {{else}}
            <p class="flag red">You need {{pluralize "outside player" player_deficit}} to field a team.</p>
          {{/if_equals}}
        {{/if_equals}}
          
        <div class="roster">
          {{#if expanded}}
            <a class="hide_roster inset">Hide roster<span class="icon12 dropup"></span></a>
            <ul class="player_list miniature state_aware">
              {{#each player_availabilities}}
                {{> player_availability }}
              {{/each}}
            </ul>
          {{else}}
            <a class="show_roster inset">View roster <span class="icon12 dropdown"></span></a>
          {{/if}}
        </div>          
      </div>
    </form>
  </li>
</template>

<template name="date_chooser">
  <div class="date_chooser" name="date">
    <label for="date">Date</label>
    <div id="{{date_field_id}}" value="{{date_for_input}}"></div>
    {{attach_date_picker}}
    <div class="time_selects">
      <label>Time</label>
      {{#with possible_hours}}{{> select }}{{/with}}
      {{#with possible_minutes}}{{> select }}{{/with}}
    </div>
    <button class="close btn default">Close</button>
  </div>
</template>



<template name="player_availability">
  <li class="player {{availability_class availability}} small_player">
    {{#with player}}
      <div class="image">
        <span class="icon16 checkmark"></span>
        <span class="icon16 close"></span>
        <span class="icon16 player"></span>
        <img src="{{ facebook_profile_url }}"/>
      </div>
      <span class="name">{{attributes.name}}</span>
    {{/with}}
  </li>
</template>

